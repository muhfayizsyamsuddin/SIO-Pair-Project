<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Orders</title>
    <style>
    body {
        font-family: sans-serif;
        margin: 0;
        background: #f9f9f9;
        color: #333;
    }
    nav {
        background: #333;
        color: #fff;
        padding: 20px 20px;
        text-align: center;
    }
    nav a {
        color: #fff;
        margin-right: 15px;
        text-decoration: none;
    }
    nav a:hover {
        text-decoration: underline;
    }
    .container {
        max-width: 800px;
        margin: 40px auto;
        background: #fff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
        color: #222;
    }
    .features-list {
        margin-top: 20px;
        padding-left: 20px;
    }
    .features-list li {
        margin-bottom: 10px;
    }
    </style>
</head>
<body>
    <nav>
        <a href="/">Home</a>
        <a href="/menus">Menu</a>
    </nav>
    <h1>Your Orders</h1>
    
    <% if (success) { %>
        <p style="color: green;"><%= success %></p>
    <% } %>

    <% if (orders.length === 0) { %>
        <p>No orders yet.</p>
    <% } else { %>
        <table border="2">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Menu Name</th>
                    <th>Time</th>
                    <th>Quantity</th>
                    <th>Price per Item</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
                <% orders.forEach((order, i) => { %>
                    <% order.OrderMenus.forEach(orderMenu => { %>
                        <tr>
                            <td style="text-align: center;"><%= i + 1 %></td>
                            <td style="text-align: center;"><%= orderMenu.Menu.name %> <br>
                                <img width="200px" src="<%= orderMenu.Menu.imageUrl %>" alt="gambar">
                            </td>
                            <td style="text-align: center;"><%= order.formatDate %></td>
                            <td style="text-align: center;">
                                <% if (order.statusOrder === 'active') { %>
                                    <form action="/orders/<%= orderMenu.id %>/edit" method="POST" style="display: inline;">
                                        <input type="number" name="quantity" value="<%= orderMenu.quantity %>" min="1" style="width: 50px;">
                                        <button type="submit">Tambah</button>
                                    </form>
                                <% } else { %>
                                    <span><%= orderMenu.quantity %></span>
                                <% } %>
                            </td>
                            <td style="text-align: center;"><%= formatRupiah(orderMenu.priceAtOrder) %></td>
                            <td style="text-align: center;"><%= order.statusOrder %></td>
                            <td style="text-align: center;">
                                <% if (order.statusOrder === 'active') { %>
                                    <form action="/orders/<%= orderMenu.id %>/delete" method="POST" style="display:inline;">
                                        <button type="submit">Hapus</button>
                                    </form>
                                    <form action="/orders/<%= order.id %>/pay" method="POST" style="display:inline;">
                                        <button type="submit">Bayar</button>
                                    </form>
                                <% } else { %>
                                    <span style="color: gray;">Sudah dibayar</span>
                                <% } %>

                                <% if (order.statusOrder === 'completed') { %>
                                    <a href="/orders/invoice/<%= order.id %>">
                                        <button>Download Invoice</button>
                                    </a>
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                <% }) %>
        </table>
    <% } %>
</body>
</html>
